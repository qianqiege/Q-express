<% if (typeof pjax === "undefined") { %>
    <%- include ../header %>
<% } else { %>
    <title><%= title %></title>
<% } %>
<style>
#rate p {
    margin-bottom: 0.1rem;
}
</style>
    <div class="page-header">
        <h1 class="page-title"><%= title %></h1>
    </div>
    <div class="page-content mainarea">
        <div class="panel needidAABBCCDD">
            <div class="panel-body">
            <div id="print-this">
                <div id="head">
                    <img id="table-logo" src="/images/logo-blue.png"/>
                    <h4 class="vertical-align-bottom pull-xs-right">编号: <span class="table_id"></span> </h4>
                    <script>
                     setTimeout(function(){ $("#table-logo").next().css("margin-top",$("#table-logo").height() - $("#table-logo").next().height()+"px")},100)
                    </script>
                    <hr/>
                </div>
                <h2 class="text-xs-center">御邦医通龙氏脊筑方案</h2>
                <div>
                  <div id="base_info">
                      <h4>
                        <i class="icon wb-user" aria-hidden="true"></i> 基本信息
                      </h4>
                      <table class="table">
                          <tr>
                            <td>姓名 : <span class="name"></span></td>
                            <td>性别 : <span class="sex"></span></td>
                            <td>出生年月 : <span class="born_date"></span></td>
                          </tr>
                          <tr>
                            <td>婚姻状况 : <span class="marriage"></span></td>
                            <td>民族 : <span class="country"></span></td>
                            <td>联系方式 : <span class="contact"></span></td>
                          </tr>
                      </table>
                  </div>
                  <div id="rate">
                      <h4>
                        <i class="icon wb-book" aria-hidden="true"></i> 健康管理师诊断
                      </h4>
                      <div class="row" style="font-size:16px; padding-bottom: 5px;">
                            <div class="col-md-12">
                                <div>身体状况描述 :
                                  <p style="text-indent:25px" class="rate_sl"></p>
                                </div>
                            </div>
                            <div class="col-md-12">
                                <div>诊断意见 :
                                  <p style="text-indent:25px" class="rate_qz"> </p>
                                </div>
                            </div>
                      </div>
                  </div>
                  <hr/>
                  <div id="issue">
                        <h4>龙氏脊筑方案  : </h4>
                        <div class="row">
                            <div class="form-group col-md-10 offset-lg-1  col-xs-12 ">
                                <table class="table table-bordered">
                                    <tr>
                                        <th>筑脊师级别/脊柱干预步骤 </th>
                                        <th>单次</th>
                                        <th>首次疗程</th>
                                        <th>养护（第二次起）</th>
                                    </tr>
                                    <tr>
                                        <td rowspan="6">
                                            <p>等级:&nbsp;<span class = "treatment_level"></span></p>
                                            <p>龙氏脊筑次数:&nbsp;<span class = "treatment_times"></span></p>
                                            <p>放血排毒次数:&nbsp;<span class = "blood_times"></span></p>
                                        </td>

                                    </tr>
                                    <tr>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="单次_neck" name = "spine"/> 颈椎：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="首次疗程_neck" name = "spine"/> 颈椎：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="养护（第二次起）_neck" name = "spine"/> 颈椎：<span></span></label></td>
                                    </tr>
                                    <tr>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="单次_thoracic" name = "spine"/> 胸椎：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="首次疗程_thoracic" name = "spine"/> 胸椎：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id ="养护（第二次起）_thoracic" name = "spine" /> 胸椎：<span></span></label></td>
                                    </tr>
                                    <tr>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()"  id ="单次_lumbar" name = "spine"/> 腰椎：<span></span></label> </td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()"  id ="首次疗程_lumbar" name = "spine"/> 腰椎：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()"  id ="养护（第二次起）_lumbar" name = "spine"/> 腰椎：<span></span></label></td>
                                    </tr>
                                    <tr>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="单次_pelvis" name = "spine"/> 骨盆：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="首次疗程_pelvis" name = "spine"/> 骨盆：<span></span></label></td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="养护（第二次起）_pelvis" name = "spine"/> 骨盆：<span></span></label> </td>
                                    </tr>
                                    <tr>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="单次_whole_ridge" name = "spine"/> 全脊：<span></span></label> </td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="首次疗程_whole_ridge" name = "spine"/> 全脊：<span></span></label>  </td>
                                        <td> <label> <input type="checkbox" value="1" onchange="caculate()" id="养护（第二次起）_whole_ridge" name = "spine"/> 全脊：<span></span></label>  </td>
                                    </tr>
                                </table>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-2 offset-lg-10  col-xs-12">
                                    <p>总价：<span class = "total"></span></p>
                            </div>
                        </div>
                         <hr/>
                        <div class="row">
                            <div>
                                <h4  class="text-xs-left col-xs-6">健管专家 : <span class="docter_name"></span></h4>
                                <h4  class="text-xs-right col-xs-6">日期 : <span class="date"></span></h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            </div>
                <div class="panel-footer">
                    <a class="btn btn-primary btn-round waves-effect pull-xs-right" href="javascript:void(0)" onclick='$(".needidAABBCCDD #print-this").printArea()'>
                        <i class="icon wb-print" aria-hidden="true"></i>
                        <span class="hidden-sm-down">打印该方案</span>
                    </a>
                </div>
            </div>
        </div>
<script>
$(function() {
    var uid = getvl("id");
    if (!uid) {
        swal({title: "id 错误", type: "error"}, function() {
            window.close();
        });
        return;
    }

    var template = $('.mainarea').html();
    $('.mainarea').html('')
    function uuid() {
        return 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random()*16|0, v = c == 'x' ? r : (r&0x3|0x8);
            return v.toString(16);
        });
    }

    function createpanel(){
        var id = uuid();
        var html = template.replace(/needidAABBCCDD/g,id)
        console.log($(html))
        $(".mainarea").append($(html))
        return id;
    }

    var cbFunction = function(data,status){
        if (status) {
            for (var i1 in data.spine_recipes){
                var id = createpanel();
                console.log(id)
                var check_spine = data.spine_recipes[i1].detail;
                var check_spine_arr =JSON.parse(check_spine);
                for (var i in check_spine_arr) {
                    $("."+id+" #"+ check_spine_arr[i]).prop("checked",true);
                }
                console.log(check_spine_arr)
                console.log($("."+id+" input:checkbox"), $("."+id+" #total"))
                $("."+id+" input:checkbox").prop("disabled",true);
                $("."+id+" .total").text(data.spine_recipes[i1].total);
                $("."+id+" .treatment_level").text(data.spine_recipes[i1].treatment_level);
                $("."+id+" .treatment_times").text(data.spine_recipes[i1].treatment_times);
                $("."+id+" .rate_sl").text(data.spine_recipes[i1].physical_condition)
                $("."+id+" .rate_qz").text(data.spine_recipes[i1].diagnostic_advice)
                $("."+id+" .docter_name").text(data.spine_recipes[i1].doctor_name)
                $("."+id+" .blood_times").text(data.spine_recipes[i1].blood_letting_times)
                $("."+id+" .date").text(new Date().Format("yyyy-MM-dd"))
                $("."+id+" .table_id").text(uid)
                $("."+id+" .name").text(data.patient.name)
                $("."+id+" .sex").text(data.patient.sex)
                $("."+id+" .born_date").text(data.patient.birthday)
                $("."+id+" .marriage").text(data.patient.marriage)
                $("."+id+" .country").text(data.patient.nation)
                $("."+id+" .contact").text(data.patient.phone)
            }
            
           


        } else {
            swal({title: "id 错误", type: "error"}, function() {
                window.close();
            });
            return false;
        }



    }
    doAjax(window.baseUrl + "/registration/check_info", "get", {"number": uid}, cbFunction);
})
</script>
<script src="/javascripts/jquery.PrintArea.js"></script>
<% if (typeof pjax === "undefined") { %>
    <%- include ../footer %>
<% } %>
